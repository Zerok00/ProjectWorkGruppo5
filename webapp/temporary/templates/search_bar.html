<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Searchbar prova</title>
    <link href="../static/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
            href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
            rel="stylesheet">
    <link href="../static/css/sb-admin-2.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .list-group-item:hover{
            background-color: lightblue;
        }
    </style>
</head>
<body>
<div class="container-fluid" style="margin-top: 15px">
    <div class="row">
        <div class="col-3">
            <form class="d-flex" id="search-bar" role="search">
                <input class="form-control me-2" id="barra_ricerca" type="search" placeholder="Search" aria-label="Search"
                       onkeyup="search(event)">
                <button class="btn btn-primary" type="submit"><i class="fas fa-fw fa-search"></i></button>
            </form>
        </div>
    </div>
    <div class="row">
        <div class="col-3">
            <ul class="list-group">
            </ul>
        </div>
    </div>
</div>

{% block javascript %}
    <script>
        const result = document.querySelector(".list-group");

        let list = [];

        let keywords = JSON.parse({{comuni | tojson}})

        const startsWith = (keyword, inputKeyword) =>
          keyword.toLocaleLowerCase().startsWith(inputKeyword.toLocaleLowerCase());

        const generateList = () => (list = list.map((data) => (data = liTag(data))));

        const showList = (inputKeyword) => {
          result.classList.add("show");
          result.innerHTML = list.join("") || liTag(inputKeyword);
        };

        const hideList = () => {
          list = [];
          result.innerHTML = list;
          result.classList.remove("show");
        };

        const liTag = (value) =>
          `<li class="list-group-item" onclick="funzione(this)">${value}</li>`;

        function funzione(list){
                document.getElementById("barra_ricerca").value = list.innerHTML;
                result.innerHTML = '';
            }

        const search = (e) => {
          let keyword = e.target.value;

          if (keyword.length >= 2) {
            filter(keyword);
            generateList();
            showList(keyword);
          } else hideList();
        };

        const filter = (inputKeyword) =>
          (list = keywords.filter(
            (keyword) =>
              startsWith(keyword, inputKeyword)
          ));
    </script>

{% endblock %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>